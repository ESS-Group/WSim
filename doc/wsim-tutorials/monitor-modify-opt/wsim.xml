<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
	  "/usr/share/sgml/docbook/dtd/4.5/docbookx.dtd">

<book lang="en">
  <bookinfo>
    <title>WSim Hardware Platform Simulator: interact with your program variables</title>
    <copyright><year>2005</year><holder>Worldsens</holder></copyright>
    <subtitle>Tutorial</subtitle>
    <authorgroup>
      <author>
	<firstname>Loïc</firstname>
	<surname>Lemaître</surname>
	<affiliation>
	  <orgname>INRIA Rhône Alpes</orgname>
	  <orgdiv>Amazones Project</orgdiv>
	  <address>
	    CITI Laboratory
	    Domaine Scientifique de la Doua, INSA de Lyon
	    Bâtiment Claude Chappe 
	    6, avenue des Arts	
	    69621 Villeurbanne Cedex
	    France
	  </address>
	</affiliation>
      </author>
    </authorgroup>
    <revhistory>
      <revision>
	<revnumber>1.0</revnumber><date>2009-12-07</date>
	<revremark>First Draft</revremark>
      </revision>
    </revhistory>
    <abstract>
      <para>WSim tutorial for debugging your program variables.</para>
    </abstract>
  </bookinfo>

  <!-- ============================================================ -->
  <!-- ============================================================ -->
  <!-- ============================================================ -->

  <chapter id="introduction">
    <title>Introduction</title>
    
    <para>
      This tutorial is intended to teach you how to use the WSim's <userinput>--monitor</userinput> and <userinput>--modify</userinput> options. 
    </para>
    <para>    
      These options are designed to help you to debug your <userinput>*.elf</userinput> program. The <userinput>--monitor</userinput> tool enables you to trace your own program global variables during an entire simulation, and the <userinput>--modify</userinput> one allows you to initialize a global variable of your <userinput>*.elf</userinput> file.
   </para>
    <para>
      The tutorial is based on the simple leds examples on wsn430 platform.
    </para>

    <para>
      This tutorial assumes that you are familiar with the basics of WSim and its associated tools. If not please first visit the WSim main tutorial.
    </para>
    
    <para>
      <itemizedlist mark="bullet" spacing="normal">
	<listitem>
	  <simpara>
	    WSim <ulink url="http://wsim.gforge.inria.fr/">WSim website</ulink>.
	  </simpara>
	</listitem>
	<listitem>
	  <simpara>
	    WSim hands-on tutorial <ulink url="http://wsim.gforge.inria.fr/tutorials/wsim/">WSim tutorial</ulink>.
	  </simpara>
	</listitem>
      </itemizedlist>
    </para>
  </chapter>

  <!-- ============================================================ -->
  <!-- ============================================================ -->
  <!-- ============================================================ -->

  <chapter id="monitor">
    <title>Monitor option</title>

    <section id="mon_wsim_conf">
      <title>WSim configuration</title>
      <para>
	In order to use WSim <userinput>--monitor</userinput> parameter, WSim must have been compiled with <userinput>--enable-xdebug</userinput> (that is the case by default).
      </para>
      <para>
	Here is one example of configuration :
      </para>
      <programlisting><computeroutput>./configure --enable-xdebug --enable-gui</computeroutput></programlisting>
    </section>

      <section id="monitor_usage">
	<title>Usage</title>

	<section id="monitor_descrip">
	  <title>Full description</title>
	  <para>
	    <userinput>--monitor</userinput> option enables you to monitor the value of a global variable or a memory space when reading or writing it.
	  </para>
	  <para>
	  You can record the trace of a set of variables separated by commas. The number of variables you can monitor is quite high and you can verify in the WSim log file that your variables are found in wsim by looking at the section <userinput>Memory</userinput>.
	  <note>
	    <title>Traceable variables</title>
	    <para>
	      You can use any C global variable from your program, but hardware registers cannot be monitored by this way.
	    </para>
	  </note>
	  </para>
	  <para>
	  A trace is recorded each time the concerning memory address is read, written, or both. Traces are stored in the <userinput>*.trc</userinput> file generated by WSim in a section called <userinput>monitor</userinput>.
	  </para>
	  <note>
	    <title>The <userinput>--trace</userinput> option</title>
	    <para>
	      To make the monitor option active, you must use at the same time the <userinput>--trace</userinput>  parameter on the command line. Otherwise the trace file will be empty!
	    </para>
	  </note>
	</section>

	<section id="monitor_syntax">
	  <title>Syntax</title>
	  <para>
	    <userinput>--monitor=[symbol1]:[options1],[addr2]:[size2]:[options2], ...,[argN]:[optionsN]</userinput>
	  </para>
	  <para>
	    <itemizedlist mark="bullet" spacing="normal">
	      <listitem>
		<simpara>
		  <userinput>symbol</userinput> is a global variable name.
		</simpara>
	      </listitem>
	      <listitem>
		<simpara>
		  <userinput>addr</userinput> is a memory address. In that case you have to specify with its <userinput>size</userinput> in byte (for instance <userinput>0xabcd:2</userinput>).
		</simpara>
	      </listitem>
	      <listitem>
		<simpara>
		  <userinput>options</userinput> are <userinput>r</userinput> for "read" or/and <userinput>w</userinput> for "write". <userinput>options</userinput> are mandatory.
		</simpara>
	      </listitem>
	    </itemizedlist>
	    <note>
	      <title>Variables names</title>
	      <para>
		Case is sensitive for variable names.
	      </para>
	    </note>
	    <note>
	      <title>Memory space</title>
	      <para>
		 Adresses are in hexadecimal, so they must be prefixed with <userinput>0x</userinput>. Size may be ommited, in this case, the default size is 1 byte.
	      </para>
	    </note>
	  </para>
	</section>

      </section>

  </chapter>

  <!-- ============================================================ -->
  <!-- ============================================================ -->
  <!-- ============================================================ -->

  <chapter id="modify">
    <title>Modify option</title>

    <section id="mod_wsim_conf">
      <title>WSim configuration</title>
      <para>
	In order to use WSim <userinput>--modify</userinput> parameter, WSim must have been compiled with <userinput>--enable-xdebug</userinput> (that is the case by default).
      </para>
    </section>

      <section id="modify_usage">
	<title>Usage</title>

	<section id="modify_descrip">
	  <title>Full description</title>
	  <para>
	    <userinput>--modify</userinput> option enables to change the value of a global variable just after initialization.
	  </para>
	</section>

	<section id="modify_syntax">
	  <title>Syntax</title>
	  <para>
	    <userinput>--modify=[arg1]:[val1], ...,[argN]:[valN]</userinput>
	  </para>
	  <para>
	    <itemizedlist mark="bullet" spacing="normal">
	      <listitem>
		<simpara>
		  <userinput>arg</userinput> is a variable name or a memory address (0xabcd for instance)
		</simpara>
	      </listitem>
	      <listitem>
		<simpara>
		  <userinput>option</userinput> is <userinput>r</userinput> for "read" or/and <userinput>w</userinput> for "write". 
		</simpara>
	      </listitem>
	    </itemizedlist>
	    <note>
	      <title>Variable names</title>
	      <para>
		Case is sensitive for variable names.
	      </para>
	    </note>
	  </para>
	</section>

      </section>


  </chapter>

  <!-- ============================================================ -->
  <!-- ============================================================ -->
  <!-- ============================================================ -->


</book>



